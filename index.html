<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>在庫記録フォーム</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>在庫を記録</h2>
  <form id="stockForm">
    <label>購入店: <input type="text" name="store" required></label><br><br>
    <label>数量　: <input type="number" name="amount" required></label><br><br>
    <label>班　　: <input type="text" name="team" required></label><br><br>
    <input type="hidden" name="user" id="userField">
    <button type="submit">送信</button>
  </form>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbzVMGhu6kg3M2KXtncfy_G9FKVzPjM-GOOGqK2fITn-b0-gcRB-NXGzrEaDa_2VvvCL/exec";
    const LIFF_ID = "2007685103-P26pEq9z";

    async function main() {
      await liff.init({ liffId: LIFF_ID });
      const profile = await liff.getProfile();
      document.getElementById("userField").value = profile.displayName;

      document.getElementById("stockForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const form = e.target;
        const data = {
          store: form.store.value,
          amount: form.amount.value,
          team: form.team.value,
          user: form.user.value
        };

        fetch(GAS_URL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: {
            "Content-Type": "application/json"
          }
        })
        .then(() => {
          alert("記録しました！");
          liff.closeWindow();
        })
        .catch(err => alert("送信失敗: " + err));
      });
    }

    main();
  </script>
</body>
</html>
